<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTOS: &lt;tt&gt;eventhandlingqueue.c&lt;/tt&gt; 튜토리얼</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RTOS<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<div id="main-nav">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="topics.html"><span>Topics</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- main-nav -->
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title"><span class="tt">eventhandlingqueue.c</span> 튜토리얼 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md157"></a></p>
<p>이 문서는 <span class="tt">eventhandlingqueue.c</span> 예제 코드의 목적, 동작 방식 및 예상 결과에 대해 설명합니다.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md158"></a>
1. Objective (목표)</h1>
<p>이 예제의 주요 목표는 FreeRTOS의 큐(Queue)를 활용한 여러 가지 이벤트를 한 곳에서 모아서 처리 패턴을 보여주고자함. (* FreeRtos 동적 메모리 할당/해제 주의하여 볼것 )</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md159"></a>
2.Code Description (코드 설명)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md160"></a>
<span class="tt">eIPEvent_t</span> – 이벤트 종류 정하기</h2>
<ul>
<li>시스템에서 발생할 수 있는 여러 가지 상황을 **이벤트 이름으로 구분**합니다.<ul>
<li><span class="tt">eNetworkDownEvent</span> → 네트워크 끊김</li>
<li><span class="tt">eNetworkRxEvent</span> → 데이터 도착</li>
<li><span class="tt">eTCPAcceptEvent</span> → 새로운 연결 요청</li>
</ul>
</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md162"></a>
<span class="tt">IPStackEvent_t</span> – 이벤트 한 개를 담는 구조</h2>
<ul>
<li>하나의 이벤트는 다음 두 정보를 가집니다:<ul>
<li><span class="tt">eEventType</span>: 어떤 종류의 이벤트인지 (<span class="tt"><a class="el" href="7__2__eventhandlingqueue_8c.html#a15b56223e35c3a63499a99f33f1915b0">eIPEvent_t</a></span> 값)</li>
<li><span class="tt">pvData</span>: 이벤트와 관련된 <b>추가 데이터(포인터)</b> <br  />
 → 예: 도착한 데이터, 소켓 정보 등 <br  />
 → 데이터가 없으면 <span class="tt">NULL</span></li>
</ul>
</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md164"></a>
<span class="tt">vSend...</span> 함수들 – 이벤트를 만드는 함수</h2>
<ul>
<li>각각의 함수는 특정 이벤트를 만들어서 큐에 넣습니다.<ul>
<li><span class="tt"><a class="el" href="7__2__eventhandlingqueue_8c.html#a327fa7c87d7f0b3b9ec3a39030c96e6a">vSendRxDataToTheTCPTask()</a></span> → 데이터 도착 이벤트 전송</li>
<li><span class="tt"><a class="el" href="7__2__eventhandlingqueue_8c.html#a5f1f6a3a331ffcd084020b75f1d784ba">vSendAcceptRequestToTheTCPTask()</a></span> → 소켓 연결 요청 이벤트 전송</li>
<li><span class="tt"><a class="el" href="7__2__eventhandlingqueue_8c.html#a7f91de821e71a54305bf213dbc9bbc58">vSendNetworkDownEventToTheTCPTask()</a></span> → 네트워크 끊김 알림</li>
</ul>
</li>
<li>이벤트에 데이터가 필요하면,<ul>
<li>먼저 <span class="tt"><a class="el" href="portable_8h.html#a7aaf584d8f548d7f03d6a46280c9e877">pvPortMalloc()</a></span>으로 <b>동적 메모리 할당</b></li>
<li>포인터를 <span class="tt">pvData</span>에 넣어 큐에 함께 보냄</li>
</ul>
</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md166"></a>
<span class="tt">vTCPTask(void *pvParameters)</span> – 이벤트를 처리하는 Task</h2>
<ul>
<li>이 Task는 **이벤트를 하나씩 받아서 처리**하는 중앙 관리자입니다.</li>
<li>큐에서 이벤트를 꺼내고(<span class="tt"><a class="el" href="queue_8h.html#ae8364d988c6f9b63c771cc2b3dfe5df9">xQueueReceive()</a></span>), <br  />
 <span class="tt">switch</span>문으로 이벤트 종류를 확인해 각각 다르게 처리합니다.</li>
<li>이벤트에 딸려온 데이터는 모두 사용 후 <span class="tt"><a class="el" href="portable_8h.html#a735cd3085bb7ba06ff8e47565bfd7016">vPortFree()</a></span>로 메모리 해제해야 함.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md168"></a>
<span class="tt">vEventSimulatorTask(void *pvParameters)</span> – 더미 이벤트</h2>
<ul>
<li>실제 네트워크 대신 **가짜 이벤트**를 순서대로 만들어서 큐에 보냅니다.</li>
<li>예:<ul>
<li>"데이터 도착" → "연결 요청" → "네트워크 끊김"</li>
</ul>
</li>
<li>테스트가 끝나면 자기 자신을 종료함 (<span class="tt">vTaskDelete(NULL)</span>)</li>
</ul>
<hr  />
<h3 class="doxsection"><a class="anchor" id="autotoc_md170"></a>
<span class="tt">main(void)</span> – 시작점</h3>
<ul>
<li><span class="tt">xQueueCreate()</span>로 이벤트 큐(<span class="tt">xNetworkEventQueue</span>)를 만듭니다.</li>
<li><span class="tt">vTCPTask</span>, <span class="tt">vEventSimulatorTask</span> 두 개의 Task를 생성합니다.<ul>
<li><span class="tt">vTCPTask</span>의 우선순위가 더 높음 (이벤트 먼저 처리하게 함)</li>
</ul>
</li>
<li><span class="tt"><a class="el" href="task_8h.html#aaf9dca1065c60abdeb309d56ab7293cb">vTaskStartScheduler()</a></span>로 FreeRTOS 실행 시작!</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md171"></a>
3. Expected Output (예상 결과)</h1>
<p><span class="tt">vEventSimulatorTask</span>가 순차적으로 이벤트를 생성하여 큐에 넣으면, 우선순위가 더 높은 <span class="tt">vTCPTask</span>가 즉시 해당 이벤트를 수신하여 처리합니다. 모든 이벤트 처리가 완료된 후 <span class="tt">vEventSimulatorTask</span>는 종료됩니다.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md172"></a>
3.1. 시리얼 출력 (Serial Output)</h2>
<div class="fragment"><div class="line">[TCP Task] Task started</div>
<div class="line">[TCP Task] Queue waiting: 0</div>
<div class="line"> </div>
<div class="line">[SIM] 시뮬레이션 이벤트...</div>
<div class="line"> </div>
<div class="line">[TCP Task] Queue waiting: 1</div>
<div class="line">[TCP Task] Event received: 1</div>
<div class="line">Received data: Hello from network!</div>
<div class="line"> </div>
<div class="line">[TCP Task] Queue waiting: 1</div>
<div class="line">[TCP Task] Event received: 2</div>
<div class="line">Accepted socket id: 42</div>
<div class="line"> </div>
<div class="line">[TCP Task] Queue waiting: 1</div>
<div class="line">[TCP Task] Event received: 0</div>
<div class="line">Network down event received.</div>
<div class="line"> </div>
<div class="line">[SIM] All events sent, task terminating</div>
<div class="line"> </div>
<div class="line">[TCP Task] Queue waiting: 0</div>
<div class="line">[TCP Task] Queue waiting: 0</div>
<div class="line">[TCP Task] Queue waiting: 0</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md173"></a>
4. 동작 원리 (Mermaid Diagram)</h1>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant SimulatorTask</div>
<div class="line">    participant EventQueue</div>
<div class="line">    participant TCPTask</div>
<div class="line"> </div>
<div class="line">    TCPTask-&gt;&gt;TCPTask: 초기화 및 대기 시작</div>
<div class="line"> </div>
<div class="line">    SimulatorTask-&gt;&gt;SimulatorTask: 1. Rx 이벤트 데이터 생성 (메모리 할당)</div>
<div class="line">    SimulatorTask-&gt;&gt;EventQueue: 2. Rx 이벤트 전송</div>
<div class="line">    TCPTask-&gt;&gt;EventQueue: 3. Rx 이벤트 수신</div>
<div class="line">    TCPTask-&gt;&gt;TCPTask: 4. Rx 데이터 처리 및 메모리 해제</div>
<div class="line"> </div>
<div class="line">    SimulatorTask-&gt;&gt;SimulatorTask: 5. Accept 이벤트 데이터 생성 (메모리 할당)</div>
<div class="line">    SimulatorTask-&gt;&gt;EventQueue: 6. Accept 이벤트 전송</div>
<div class="line">    TCPTask-&gt;&gt;EventQueue: 7. Accept 이벤트 수신</div>
<div class="line">    TCPTask-&gt;&gt;TCPTask: 8. Accept 데이터 처리 및 메모리 해제</div>
<div class="line"> </div>
<div class="line">    SimulatorTask-&gt;&gt;EventQueue: 9. Network Down 이벤트 전송 (데이터 없음)</div>
<div class="line">    TCPTask-&gt;&gt;EventQueue: 10. Network Down 이벤트 수신</div>
<div class="line">    TCPTask-&gt;&gt;TCPTask: 11. Network Down 처리</div>
<div class="line"> </div>
<div class="line">    SimulatorTask-&gt;&gt;SimulatorTask: 모든 이벤트 전송 후 스스로 종료</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md174"></a>
5. 핵심 개념: 이벤트 기반 프로그래밍 (Event-Driven Programming)</h1>
<ul>
<li><b>중앙 집중 처리</b>: 여러 소스(인터럽트, 다른 태스크 등)에서 발생하는 비동기적인 이벤트들을 하나의 큐로 모아, 단일 태스크에서 순서대로 처리함으로써 시스템의 동작을 단순화하고 예측 가능하게 만듭니다.</li>
<li><b>디커플링(Decoupling)</b>: 이벤트를 생성하는 측(Producer)과 처리하는 측(Consumer)이 큐를 통해 분리됩니다. 생산자는 이벤트 처리 방식에 대해 알 필요가 없고, 소비자도 이벤트 발생 시점에 대해 알 필요가 없습니다. 이는 코드의 모듈성과 재사용성을 높여줍니다.</li>
<li><b>데이터 전달</b>: <span class="tt">void*</span> 포인터를 사용하여 어떤 종류의 데이터든 유연하게 전달할 수 있습니다. 단, 데이터를 수신한 측에서 정확한 타입으로 캐스팅하고, 동적으로 할당된 메모리를 해제하는 책임을 져야 합니다. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
