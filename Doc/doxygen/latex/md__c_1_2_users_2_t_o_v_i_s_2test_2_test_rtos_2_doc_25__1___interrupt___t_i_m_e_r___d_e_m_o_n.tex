\chapter{Free\+RTOS -\/ 인터럽트 처리 지연 호출 ({\ttfamily x\+Timer\+Pend\+Function\+Call\+From\+ISR}) 예제 }
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n}{}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n}\index{FreeRTOS -\/ 인터럽트 처리 지연 호출 ($<$tt$>$xTimerPendFunctionCallFromISR$<$/tt$>$) 예제@{FreeRTOS -\/ 인터럽트 처리 지연 호출 ($<$tt$>$xTimerPendFunctionCallFromISR$<$/tt$>$) 예제}}
\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md128}%
\Hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md128}%
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md129}{}\doxysection{\texorpdfstring{1. 목적 (Objective)}{1. 목적 (Objective)}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md129}
인터럽트가 발생했을 때, ~\newline
 그 처리를 {\ttfamily 현재 Task가 끝난 뒤로 지연시켜} 실행하는 구조를 테스트

\begin{quote}
핵심\+: {\ttfamily \doxylink{timers_8h_ae0d9338933037e6feebe6437763fa299}{x\+Timer\+Pend\+Function\+Call\+From\+ISR()}} 사용 → 인터럽트 안에서 실질 처리를 바로 하지 않고, ~\newline
 {\ttfamily Timer Service Task}가 나중에 처리하도록 요청함으로써 시스템의 안정성과 예측성을 향상 \end{quote}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md131}{}\doxysection{\texorpdfstring{2. 시스템 구성}{2. 시스템 구성}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md131}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 구성 요소  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 설명  }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 구성 요소  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 설명  }\\\cline{1-2}
\endhead
{\ttfamily EXTI15\+\_\+10\+\_\+\+IRQHandler}  &인터럽트 발생 시, 처리 함수 요청을 큐에 등록 (지연 실행)  \\\cline{1-2}
{\ttfamily x\+Timer\+Pend\+Function\+Call\+From\+ISR}  &처리 함수 {\ttfamily v\+Deferred\+Handling\+Function}을 Timer Queue에 등록  \\\cline{1-2}
{\ttfamily v\+Periodic\+Task}  &500ms마다 인터럽트 강제 발생 ({\ttfamily HAL\+\_\+\+NVIC\+\_\+\+Set\+Pending\+IRQ})  \\\cline{1-2}
{\ttfamily v\+Deferred\+Handling\+Function}  &인터럽트에 의해 실제 처리되는 지연 함수  \\\cline{1-2}
Timer Service Task  &큐에 등록된 함수가 있는 경우 호출하여 실행  \\\cline{1-2}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md133}{}\doxysection{\texorpdfstring{3. ⛓️ 동작 시나리오}{3. ⛓️ 동작 시나리오}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md133}

\begin{DoxyEnumerate}
\item {\ttfamily \doxylink{5__1__interrupt__timerdaemmon_8c_a59963d19b60052661ffcca0eccdc1244}{v\+Periodic\+Task()}}가 실행됨
\item 내부에서 {\ttfamily \doxylink{group___c_o_r_t_e_x___exported___functions___group2_gaecf50f6c6d0e1fa5f8bd8c1b45309f18}{HAL\+\_\+\+NVIC\+\_\+\+Set\+Pending\+IRQ()}} 호출 → {\ttfamily \doxylink{4__1__semaphore__binarysemaphore_8c_a738473a5b43f6c92b80ce1d3d6f77ed9}{EXTI15\+\_\+10\+\_\+\+IRQHandler()}} 실행됨
\item ISR에서 {\ttfamily \doxylink{timers_8h_ae0d9338933037e6feebe6437763fa299}{x\+Timer\+Pend\+Function\+Call\+From\+ISR()}}를 통해 함수 실행을 요청 ~\newline
 → 아직 실행되지 않고 Timer Queue에 등록됨
\item ISR 마지막에 {\ttfamily \doxylink{portmacro_8h_aac6850c66595efdc02a8bbb95fb4648e}{port\+YIELD\+\_\+\+FROM\+\_\+\+ISR()}} 호출 → Context Switch 발생 요청
\item 현재 Task({\ttfamily v\+Periodic\+Task})가 {\ttfamily \doxylink{task_8h_aa154068cecd7f31446a7a84af44ab1a3}{v\+Task\+Delay()}}로 Block 상태 진입
\item 이제 우선순위가 높은 \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Timer Service Task\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}가 실행됨
\item {\ttfamily v\+Deferred\+Handling\+Function()} 실행됨 → 실제 인터럽트 처리 수행
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md135}{}\doxysection{\texorpdfstring{4. 주요 API 설명}{4. 주요 API 설명}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md135}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ API  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 설명  }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ API  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 설명  }\\\cline{1-2}
\endhead
{\ttfamily x\+Timer\+Pend\+Function\+Call\+From\+ISR(func, param1, param2, \&flag)}  &ISR에서 함수를 나중에 실행하도록 큐에 등록  \\\cline{1-2}
{\ttfamily \doxylink{portmacro_8h_aac6850c66595efdc02a8bbb95fb4648e}{port\+YIELD\+\_\+\+FROM\+\_\+\+ISR(flag)}}  &ISR 후에 우선순위 높은 Task가 있으면 Context Switch 유도  \\\cline{1-2}
{\ttfamily v\+Deferred\+Handling\+Function()}  &위임된 실제 처리 함수 (Timer Service Task가 실행)  \\\cline{1-2}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md137}{}\doxysection{\texorpdfstring{5. 출력 예시 (UART)}{5. 출력 예시 (UART)}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md137}

\begin{DoxyCode}{0}
\DoxyCodeLine{Periodic\ Task\ 실행\ 중...}
\DoxyCodeLine{인터럽트\ 처리\ 위임됨:\ Param\ =\ 0}
\DoxyCodeLine{Periodic\ Task\ 실행\ 중...}
\DoxyCodeLine{인터럽트\ 처리\ 위임됨:\ Param\ =\ 1}
\DoxyCodeLine{Periodic\ Task\ 실행\ 중...}
\DoxyCodeLine{인터럽트\ 처리\ 위임됨:\ Param\ =\ 2}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md138}{}\doxysection{\texorpdfstring{6. 왜 이런 구조를 사용하는가?}{6. 왜 이런 구조를 사용하는가?}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md138}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 항목  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 이유  }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 항목  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 이유  }\\\cline{1-2}
\endhead
ISR은 빠르게 끝나야 함  &인터럽트는 시스템 전체에 영향을 주기 때문에 최소화 필요  \\\cline{1-2}
ISR에서 {\ttfamily printf}, {\ttfamily 연산}, {\ttfamily 할당} 등은 위험  &시간 오래 걸리며 다른 인터럽트와 Task 실행을 방해  \\\cline{1-2}
Timer Service Task 활용  &시스템이 정한 우선순위와 정책에 따라 안정적으로 함수 실행 가능  \\\cline{1-2}
우선순위 조정이 유연  &Timer Task보다 우선순위가 낮은 Task에서 호출하면, 자연스럽게 defer 처리 가능  \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md139}{}\doxysection{\texorpdfstring{7. 시퀀스 다이어그램}{7. 시퀀스 다이어그램}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md139}

\begin{DoxyCode}{0}
\DoxyCodeLine{@startuml}
\DoxyCodeLine{title\ 인터럽트\ 지연\ 처리\ -\/\ Timer\ Service\ Task\ 흐름}
\DoxyCodeLine{}
\DoxyCodeLine{participant\ "{}vPeriodicTask"{}\ as\ Task}
\DoxyCodeLine{participant\ "{}EXTI\ IRQ"{}\ as\ ISR}
\DoxyCodeLine{participant\ "{}Timer\ Service\ Task"{}\ as\ Timer}
\DoxyCodeLine{participant\ "{}vDeferredHandlingFunction"{}\ as\ Handler}
\DoxyCodeLine{}
\DoxyCodeLine{loop\ Every\ 500ms}
\DoxyCodeLine{\ \ \ \ Task\ -\/>\ ISR\ :\ HAL\_NVIC\_SetPendingIRQ()}
\DoxyCodeLine{\ \ \ \ activate\ ISR}
\DoxyCodeLine{\ \ \ \ ISR\ -\/>\ Timer\ :\ xTimerPendFunctionCallFromISR()}
\DoxyCodeLine{\ \ \ \ note\ right\ of\ ISR:\ 함수\ 요청만\ 큐에\ 등록\(\backslash\)n실행은\ 아직\ 안됨}
\DoxyCodeLine{\ \ \ \ ISR\ -\/>\ Scheduler\ :\ portYIELD\_FROM\_ISR()}
\DoxyCodeLine{\ \ \ \ deactivate\ ISR}
\DoxyCodeLine{\ \ \ \ Task\ -\/>\ Task\ :\ vTaskDelay()\ →\ Block\ 상태}
\DoxyCodeLine{\ \ \ \ Timer\ -\/>\ Handler\ :\ vDeferredHandlingFunction(Param++)}
\DoxyCodeLine{\ \ \ \ Handler\ -\/>\ UART\ :\ printf("{}Param\ =\ ..."{})}
\DoxyCodeLine{end}
\DoxyCodeLine{}
\DoxyCodeLine{@enduml}

\end{DoxyCode}
 \hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md140}{}\doxysection{\texorpdfstring{8. 관련 개념 요약}{8. 관련 개념 요약}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md140}
개념 설명
\begin{DoxyItemize}
\item Defer Interrupt Processing ISR에서 함수를 바로 실행하지 않고, 나중에 Task에서 실행하게 함
\item \doxylink{timers_8h_ae0d9338933037e6feebe6437763fa299}{x\+Timer\+Pend\+Function\+Call\+From\+ISR()} ISR에서 안전하게 처리 요청만 등록
\item Timer Service Task 타이머 및 지연 처리 전담 Task
\item Context Switch 높은 우선순위 Task로 전환 유도
\item \doxylink{portmacro_8h_aac6850c66595efdc02a8bbb95fb4648e}{port\+YIELD\+\_\+\+FROM\+\_\+\+ISR()} ISR 후 스케줄러가 즉시 전환할 수 있도록 유도
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md141}{}\doxysection{\texorpdfstring{9. 체크리스트}{9. 체크리스트}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_25__1___interrupt___t_i_m_e_r___d_e_m_o_n_autotoc_md141}

\begin{DoxyItemize}
\item ISR은 처리 최소화 (No printf, No HAL\+\_\+\+Delay)
\item 우선순위 조정 (Periodic Task \texorpdfstring{$<$}{<} Timer Service Task)
\item \doxylink{timers_8h_ae0d9338933037e6feebe6437763fa299}{x\+Timer\+Pend\+Function\+Call\+From\+ISR()} 호출 성공 여부 확인
\item \doxylink{portmacro_8h_aac6850c66595efdc02a8bbb95fb4648e}{port\+YIELD\+\_\+\+FROM\+\_\+\+ISR()} 사용으로 즉시 Context Switch 요청 
\end{DoxyItemize}