\chapter{Free\+RTOS Mailbox Queue Example }
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e}{}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e}\index{FreeRTOS Mailbox Queue Example@{FreeRTOS Mailbox Queue Example}}
\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md91}%
\Hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md91}%
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md92}{}\doxysection{\texorpdfstring{1.목적 (Objective)}{1.목적 (Objective)}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md92}
Free\+RTOS의 {\ttfamily \doxylink{queue_8h_a8e9ced123b5a0e37a36d3bbdb2e56b4e}{x\+Queue\+Overwrite()}}와 {\ttfamily \doxylink{queue_8h_a3f9e430276fe5244417fd82644ec8a75}{x\+Queue\+Peek()}} API를 사용하여 ~\newline
 {\ttfamily 가장 최신 데이터만 가져오는 큐(메일박스)를 테스트
\begin{DoxyItemize}
\item 송신 Task는 주기적으로 값과 타임스탬프를 큐에 
\end{DoxyItemize}}덮어쓰기(x\+Queue\+Overwrite){\ttfamily  방식으로 전송합니다.
\begin{DoxyItemize}
\item 수신 Task는 
\end{DoxyItemize}}\doxylink{queue_8h_a3f9e430276fe5244417fd82644ec8a75}{x\+Queue\+Peek()}{\ttfamily 을 통해 큐의 내용을 읽고, 마지막으로 받은 timestamp와 비교하여 }중복 출력 방지\`{} 처리를 합니다.

\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md94}{}\doxysection{\texorpdfstring{2.시스템 구성}{2.시스템 구성}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md94}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Task 이름  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 역할  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 주요 API 사용  }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Task 이름  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 역할  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ 주요 API 사용  }\\\cline{1-3}
\endhead
{\ttfamily v\+Updater\+Task}  &주기적으로 값 증가 후 Mailbox에 덮어쓰기  &{\ttfamily \doxylink{queue_8h_a8e9ced123b5a0e37a36d3bbdb2e56b4e}{x\+Queue\+Overwrite()}}  \\\cline{1-3}
{\ttfamily v\+Reader\+Task}  &Mailbox에서 최신 값만 확인하고 출력  &{\ttfamily \doxylink{queue_8h_a3f9e430276fe5244417fd82644ec8a75}{x\+Queue\+Peek()}} + 타임스탬프 비교  \\\cline{1-3}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md96}{}\doxysection{\texorpdfstring{3.동작 시나리오}{3.동작 시나리오}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md96}

\begin{DoxyEnumerate}
\item 시스템 초기화 후 길이 1의 큐({\ttfamily x\+Mailbox})가 생성됨
\item {\ttfamily v\+Updater\+Task}가 값과 Tick을 주기적으로 {\ttfamily \doxylink{queue_8h_a8e9ced123b5a0e37a36d3bbdb2e56b4e}{x\+Queue\+Overwrite()}}로 큐에 기록
\item {\ttfamily v\+Reader\+Task}는 {\ttfamily \doxylink{queue_8h_a3f9e430276fe5244417fd82644ec8a75}{x\+Queue\+Peek()}}으로 데이터를 읽음
\item 이전에 수신한 timestamp와 비교하여 중복 데이터는 무시, 새로운 데이터만 출력
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md98}{}\doxysection{\texorpdfstring{4.핵심 포인트}{4.핵심 포인트}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md98}

\begin{DoxyItemize}
\item 일반적인 큐는 가득 차면 전송 실패 ({\ttfamily \doxylink{queue_8h_af7eb49d3249351176992950d9185abe9}{x\+Queue\+Send()}} → FAIL)
\item {\ttfamily \doxylink{queue_8h_a8e9ced123b5a0e37a36d3bbdb2e56b4e}{x\+Queue\+Overwrite()}}는 큐 길이에 상관없이 {\bfseries{기존 데이터를 덮어쓰기}} 때문에 ~\newline
 {\bfseries{항상 최신 데이터만 유지\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}하는 데 적합}}
\item {\bfseries{{\ttfamily \doxylink{queue_8h_a3f9e430276fe5244417fd82644ec8a75}{x\+Queue\+Peek()}}은 데이터를 \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}제거하지 않고 읽기만}} 하므로 ~\newline
 수신자가 데이터의 변화를 감지하고 처리 가능
\end{DoxyItemize}

\DoxyHorRuler{0}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md100}{}\doxysection{\texorpdfstring{5.출력 예시 (UART 로그)}{5.출력 예시 (UART 로그)}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md100}

\begin{DoxyCode}{0}
\DoxyCodeLine{Received\ value:\ 3\ (Tick:\ 12345)}
\DoxyCodeLine{Received\ value:\ 4\ (Tick:\ 12845)}
\DoxyCodeLine{Received\ value:\ 5\ (Tick:\ 13345)}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md101}{}\doxysection{\texorpdfstring{6.\+Plant\+UML 시퀀스 다이어그램}{6.\+Plant\+UML 시퀀스 다이어그램}}\label{md__c_1_2_users_2_t_o_v_i_s_2test_2_test_rtos_2_doc_23__4___q_u_e_u_e___m_a_i_l_b_o_x_q_u_e_u_e_autotoc_md101}

\begin{DoxyCode}{0}
\DoxyCodeLine{@startuml}
\DoxyCodeLine{}
\DoxyCodeLine{participant\ UpdaterTask}
\DoxyCodeLine{participant\ xMailbox}
\DoxyCodeLine{participant\ ReaderTask}
\DoxyCodeLine{}
\DoxyCodeLine{loop\ every\ 500ms}
\DoxyCodeLine{\ \ \ \ UpdaterTask\ -\/>\ xMailbox\ :\ xQueueOverwrite(dataToSend)}
\DoxyCodeLine{end}
\DoxyCodeLine{}
\DoxyCodeLine{loop\ every\ 100ms}
\DoxyCodeLine{\ \ \ \ ReaderTask\ -\/>\ xMailbox\ :\ xQueuePeek(receivedData)}
\DoxyCodeLine{\ \ \ \ alt\ if\ receivedData.timestamp\ is\ new}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ReaderTask\ -\/>\ UART\ :\ printf(receivedData)}
\DoxyCodeLine{\ \ \ \ else}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ReaderTask\ -\/-\/>\ ReaderTask\ :\ Skip\ (duplicate)}
\DoxyCodeLine{\ \ \ \ end}
\DoxyCodeLine{end}
\DoxyCodeLine{}
\DoxyCodeLine{@enduml}

\end{DoxyCode}
 🧪 응용 가능성 센서 데이터 수집 시 최근값만 유지 UI에 최신 상태만 반영 (ex. 온도, 속도, 위치 등) CAN, UART 등에서 단일 ID에 해당하는 최신 메시지 처리용 ⚠️ 주의 과거 기록이 필요한 경우 사용하지 말것(\+Fault Log) 